{
    "collab_server" : "",
    "contents" : "library(vegan)\n\nbw.NMDS <- metaMDS(bw, distance = \"bray\", trymax = 100)\n#bw.NMDS <- metaMDS(bw, distance = \"jaccard\", binary = T, trymax = 100)\nbw.NMDS\n\nbw.ant_colmns = which(grepl(\"Formicidae\",names(bw)))\nbw.symbols <- c( rep(3, bw.ant_colmns[1] - 1), rep(19, length(bw.ant_colmns)), rep(2, length(names(bw)) - max(bw.ant_colmns)) )\nbw.colors <- c(rep(\"green\",7),rep(\"blue\",7))\n#bw.spcolors <- c( rep(\"red\", bw.ant_colmns[1] - 1), rep(\"#008800\", length(bw.ant_colmns)), rep(\"blue\", length(names(bw)) - max(bw.ant_colmns)) )\n\npdf(\"Output/BW NMDS.pdf\", width=12, height=7, useDingbats = F)\n\nstressplot(bw.NMDS, sub = bw.NMDS$stress)\n\nordiplot(bw.NMDS, type=\"n\")\nordihull(bw.NMDS, groups=bw.colors, draw=\"polygon\", col=\"#D3EAF1\", show.groups = \"blue\", label=FALSE)\nordihull(bw.NMDS, groups=bw.colors, draw=\"polygon\", col=\"#CEE9BF\", show.groups = \"green\", label=FALSE)\norditorp(bw.NMDS, display=\"species\",air=0.01, label=FALSE, pch=bw.symbols)\norditorp(bw.NMDS, display=\"sites\", air=0.01, cex=1)\n#legend(0, legend = c(\"Coleoptera\", \"Hymenoptera:Formicidae\", \"Hemiptera\"))\n#ordicluster(bw.NMDS,hclust(vegdist(bw,\"bray\"))) \n#for(i in unique(treat)) {\n#  ordihull(bw.NMDS$point[grep(i,treat),],draw=\"polygon\",groups=treat[treat==i],col=bw.colors[grep(i,treat)],label=F) } \n\nordiplot(bw.NMDS, type=\"n\")\nordihull(bw.NMDS, groups=bw.colors, draw=\"polygon\", col=\"#D3EAF1\", show.groups = \"blue\", label=FALSE)\nordihull(bw.NMDS, groups=bw.colors, draw=\"polygon\", col=\"#CEE9BF\", show.groups = \"green\", label=FALSE)\norditorp(bw.NMDS, display=\"sites\", air=0.01, cex=1)\n\nordiplot(bw.NMDS, type=\"n\")\nordihull(bw.NMDS, groups=bw.colors, draw=\"polygon\", label=FALSE)\norditorp(bw.NMDS, display=\"species\",air=0.01, label=FALSE, pch=bw.symbols)\norditorp(bw.NMDS, display=\"sites\", air=0.01, cex=1)\n\nordiplot(bw.NMDS, type=\"n\")\nordihull(bw.NMDS, groups=bw.colors, draw=\"polygon\", label=FALSE)\norditorp(bw.NMDS, display=\"sites\", air=0.01, cex=1)\n\ndev.off()\n\n######################### Am By Region\n\nbw.KZN <- bw[grepl(\"KZN\", rownames(bw)),]\nbw.KZN <- bw.KZN[,colSums(bw.KZN) != 0]\nbw.MP <- bw[grepl(\"MP\", rownames(bw)),]\nbw.MP <- bw.MP[,colSums(bw.MP) != 0]\n\nvs.KZN <- vs[grepl(\"KZN\", rownames(vs)),]\nvs.KZN <- vs.KZN[,colSums(vs.KZN) != 0]\nvs.MP <- vs[grepl(\"MP\", rownames(vs)),]\nvs.MP <- vs.MP[,colSums(vs.MP) != 0]\n\nbw_adjacent.KZN <- bw_adjacent[grepl(\"KZN\", rownames(bw_adjacent)),]\nbw_adjacent.KZN <- bw_adjacent.KZN[,colSums(bw_adjacent.KZN) != 0]\nbw_adjacent.MP <- bw_adjacent[grepl(\"MP\", rownames(bw_adjacent)),]\nbw_adjacent.MP <- bw_adjacent.MP[,colSums(bw_adjacent.MP) != 0]\n\nbw.KZN.NMDS <- metaMDS(bw.KZN, distance = \"bray\", trymax = 100)\nbw.KZN.NMDS\nbw.MP.NMDS <- metaMDS(bw.MP, distance = \"bray\", trymax = 100)\nbw.MP.NMDS\n\nbw.KZN.ant_colmns = which(grepl(\"Formicidae\",names(bw.KZN)))\nbw.MP.ant_colmns = which(grepl(\"Formicidae\",names(bw.MP)))\n\npdf(\"Output/BW NMDS By Region.pdf\", width=12, height=7, useDingbats = F)\n\nstressplot(bw.KZN.NMDS, main = \"KZN\", sub = bw.KZN.NMDS$stress)\nstressplot(bw.MP.NMDS, main = \"MP\", sub = bw.MP.NMDS$stress)\n\nordiplot(bw.KZN.NMDS, type=\"n\", main = \"KZN\")\norditorp(bw.KZN.NMDS, display=\"species\",air=0.01, label=FALSE, pch=c( rep(3, bw.KZN.ant_colmns[1] - 1), rep(19, length(bw.KZN.ant_colmns)), rep(2, length(names(bw.KZN)) - max(bw.KZN.ant_colmns)) ))\norditorp(bw.KZN.NMDS, display=\"sites\", air=0.01, cex=1)\n\nordiplot(bw.MP.NMDS, type=\"n\", main = \"MP\")\norditorp(bw.MP.NMDS, display=\"species\",air=0.01, label=FALSE, pch=c( rep(3, bw.MP.ant_colmns[1] - 1), rep(19, length(bw.MP.ant_colmns)), rep(2, length(names(bw.MP)) - max(bw.MP.ant_colmns)) ))\norditorp(bw.MP.NMDS, display=\"sites\", air=0.01, cex=1)\n\ndev.off()\n\n########################## Am & Vs NMDS\n\nbw_vs.NMDS <- metaMDS(bw_vs, distance = \"bray\", trymax = 100)\n#bw_vs.NMDS <- metaMDS(bw_vs, distance = \"jaccard\", binary = T, trymax = 100)\nbw_vs.NMDS\nbw_vs.colors <- c(rep(\"green\",9),rep(\"blue\",9))\n\nbw_vs.symbols <- c( rep(3, bw_vs.ant_colmns[1] - 1), rep(19, length(bw_vs.ant_colmns)), rep(2, length(names(bw_vs)) - max(bw_vs.ant_colmns)) )\nbw_vs.colors <- c(rep(\"green\",9),rep(\"blue\",9))\nbw_vs.spcolors <- c( rep(\"red\", bw_vs.ant_colmns[1] - 1), rep(\"#008800\", length(bw_vs.ant_colmns)), rep(\"blue\", length(names(bw_vs)) - max(bw_vs.ant_colmns)) )\n#treat <- bw_vs.colors\n\npdf(\"Output/BW_VS NMDS.pdf\", width=12, height=7, useDingbats = F)\n\nstressplot(bw_vs.NMDS, sub = bw_vs.NMDS$stress)\n# with colours & species\nordiplot(bw_vs.NMDS, type=\"n\")\nordihull(bw_vs.NMDS, groups=bw_vs.colors, draw=\"polygon\", col=\"#D3EAF1\", show.groups = \"blue\", label=FALSE)\nordihull(bw_vs.NMDS, groups=bw_vs.colors, draw=\"polygon\", col=\"#CEE9BF\", show.groups = \"green\", label=FALSE)\norditorp(bw_vs.NMDS, display=\"species\",air=0.01, label=FALSE, pch=bw_vs.symbols)\norditorp(bw_vs.NMDS, display=\"sites\", air=0.01, cex=1)\n# with colours\nordiplot(bw_vs.NMDS, type=\"n\")\nordihull(bw_vs.NMDS, groups=bw_vs.colors, draw=\"polygon\", col=\"#D3EAF1\", show.groups = \"blue\", label=FALSE)\nordihull(bw_vs.NMDS, groups=bw_vs.colors, draw=\"polygon\", col=\"#CEE9BF\", show.groups = \"green\", label=FALSE)\norditorp(bw_vs.NMDS, display=\"sites\", air=0.01, cex=1)\n# no colours, with species\nordiplot(bw_vs.NMDS, type=\"n\")\nordihull(bw_vs.NMDS, groups=bw_vs.colors, draw=\"polygon\", label=FALSE)\norditorp(bw_vs.NMDS, display=\"species\",air=0.01, label=FALSE, pch=bw_vs.symbols)\norditorp(bw_vs.NMDS, display=\"sites\", air=0.01, cex=1)\n# no colours, no species\nordiplot(bw_vs.NMDS, type=\"n\")\nordihull(bw_vs.NMDS, groups=bw_vs.colors, draw=\"polygon\", label=FALSE)\norditorp(bw_vs.NMDS, display=\"sites\", air=0.01, cex=1)\n\ndev.off()\n\n######################### Am & Vs By Region\n\nbw_vs.KZN <- bw_vs[grepl(\"KZN\", rownames(bw_vs)),]\nbw_vs.KZN <- bw_vs.KZN[,colSums(bw_vs.KZN) != 0]\nbw_vs.MP <- bw_vs[grepl(\"MP\", rownames(bw_vs)),]\nbw_vs.MP <- bw_vs.MP[,colSums(bw_vs.MP) != 0]\n\nbw_vs.KZN.NMDS <- metaMDS(bw_vs.KZN, distance = \"bray\", trymax = 100)\nbw_vs.KZN.NMDS\nbw_vs.MP.NMDS <- metaMDS(bw_vs.MP, distance = \"bray\", trymax = 100)\nbw_vs.MP.NMDS\n\nbw_vs.KZN.ant_colmns = which(grepl(\"Formicidae\",names(bw_vs.KZN)))\nbw_vs.MP.ant_colmns = which(grepl(\"Formicidae\",names(bw_vs.MP)))\n\npdf(\"Output/BW_VS NMDS By Region.pdf\", width=12, height=7, useDingbats = F)\n\nstressplot(bw_vs.KZN.NMDS, main = \"KZN\", sub = bw_vs.KZN.NMDS$stress)\nstressplot(bw_vs.MP.NMDS, main = \"MP\", sub = bw_vs.MP.NMDS$stress)\n\nordiplot(bw_vs.KZN.NMDS, type=\"n\", main = \"KZN\")\norditorp(bw_vs.KZN.NMDS, display=\"species\",air=0.01, label=FALSE, pch=c( rep(3, bw_vs.KZN.ant_colmns[1] - 1), rep(19, length(bw_vs.KZN.ant_colmns)), rep(2, length(names(bw_vs.KZN)) - max(bw_vs.KZN.ant_colmns)) ))\norditorp(bw_vs.KZN.NMDS, display=\"sites\", air=0.01, cex=1)\n\nordiplot(bw_vs.MP.NMDS, type=\"n\", main = \"MP\")\norditorp(bw_vs.MP.NMDS, display=\"species\",air=0.01, label=FALSE, pch=c( rep(3, bw_vs.MP.ant_colmns[1] - 1), rep(19, length(bw_vs.MP.ant_colmns)), rep(2, length(names(bw_vs.MP)) - max(bw_vs.MP.ant_colmns)) ))\norditorp(bw_vs.MP.NMDS, display=\"sites\", air=0.01, cex=1)\n\ndev.off()\n\n###################### Host Site Season\n\nbw_vs_region <- bw_vs_all\nbw_vs_region$Host <- as.character(bw_vs_region$Host)\nbw_vs_region$Host[bw_vs_all$Host == 'A_mearnsii'] <- \"Am\"\nbw_vs_region$Host[bw_vs_all$Host == 'A_sieberiana'] <- \"Vs\"\n# create a new Site column containing just the site extracted from the Sample column\nbw_vs_region$Site <- unlist(lapply(strsplit(as.character(bw_vs_region$Sample), \"\\\\_\"), \"[[\", 1))\n# remove Sample column\nbw_vs_region <- subset(bw_vs_region, select = -c(Sample))\n# combine number of rows and sum, per site & region\nbw_vs_region <- aggregate(. ~ Host + Site + Season, bw_vs_region, sum)\n\n.BySeason <- function(data, season) {\n  # get summer season\n  byseason <- data[data$Season == season,]\n  # set the rownames to MP1_As, etc...\n  rownames(byseason) <- do.call(paste, c(byseason[c(\"Site\", \"Host\")], sep = \"_\"))\n  # remove Site, Host & Season columns\n  byseason <- subset(byseason, select = -c(Site, Host, Season))\n  \n  byseason <- byseason[,colSums(byseason) != 0]\n}\n\nbw_vs_region.summer <- .BySeason(bw_vs_region, \"Summer\")\nbw_vs_region.summer.NMDS <- metaMDS(bw_vs_region.summer, distance = \"bray\", trymax = 100)\nbw_vs_region.summer.NMDS\nbw_vs_region.winter <- .BySeason(bw_vs_region, \"Winter\")\nbw_vs_region.winter.NMDS <- metaMDS(bw_vs_region.winter, distance = \"bray\", trymax = 100)\nbw_vs_region.winter.NMDS\nbw_vs_region.spring <- .BySeason(bw_vs_region, \"Spring\")\nbw_vs_region.spring.NMDS <- metaMDS(bw_vs_region.spring, distance = \"bray\", trymax = 100)\nbw_vs_region.spring.NMDS\n\n.NMDSPlot <- function(data, nmdsdata, main) {\n  ant_colmns = which(grepl(\"Formicidae\",names(data)))\n  symbols <- c( rep(3, ant_colmns[1] - 1), rep(19, length(ant_colmns)), rep(2, length(names(data)) - max(ant_colmns)) )\n  colors <- c( rep(\"green\", length(grep(\"KZN\", rownames(data), value = T))), rep(\"blue\",length(grep(\"MP\", rownames(data), value = T))) )\n  spcolors <- c( rep(\"red\", ant_colmns[1] - 1), rep(\"#008800\", length(ant_colmns)), rep(\"blue\", length(names(data)) - max(ant_colmns)) )\n\n  stressplot(nmdsdata, main = main, sub = nmdsdata$stress)\n  \n  ordiplot(nmdsdata, type=\"n\", main = main)\n  #ordihull(nmdsdata, groups=colors, draw=\"polygon\", col=\"grey90\", label=FALSE)\n  ordihull(nmdsdata, groups=colors, draw=\"polygon\", label=FALSE)\n  orditorp(nmdsdata, display=\"species\",air=0.01, label=FALSE, pch=symbols)\n  orditorp(nmdsdata, display=\"sites\", air=0.01, cex=1)\n}\n\npdf(\"Output/BW_VS NMDS By Season.pdf\", width=12, height=7, useDingbats = F)\n.NMDSPlot(bw_vs_region.summer, bw_vs_region.summer.NMDS, \"Summer\")\n.NMDSPlot(bw_vs_region.winter, bw_vs_region.winter.NMDS, \"Winter\")\n.NMDSPlot(bw_vs_region.spring, bw_vs_region.spring.NMDS, \"Spring\")\ndev.off()\n\n######################### Host Site Season\nbw_vs.host_site_season.NMDS <- metaMDS(bw_vs.host_site_season, distance = \"bray\", trymax = 100)\nbw_vs.host_site_season.NMDS\n\npdf(\"Output/BW_VS NMDS Host Site Season Stress Plot.pdf\", width = 10, height = 5, useDingbats = F)\nstressplot(bw_vs.host_site_season.NMDS)\ndev.off()\npdf(\"Output/BW_VS NMDS Host Site Season.pdf\", width = 16, height = 16, useDingbats = F)\nordiplot(bw_vs.host_site_season.NMDS, type=\"n\")\norditorp(bw_vs.host_site_season.NMDS, display=\"species\",air=0.01, label=FALSE, pch=c( rep(3, bw_vs.ant_colmns[1] - 1), rep(19, length(bw_vs.ant_colmns)), rep(2, length(names(bw_vs.host_site_season)) - max(bw_vs.ant_colmns)) ))\norditorp(bw_vs.host_site_season.NMDS, display=\"sites\", air=0.01, cex=1)\nordiplot(bw_vs.host_site_season.NMDS, type=\"n\")\norditorp(bw_vs.host_site_season.NMDS, display=\"sites\", air=0.01, cex=1)\nordiplot(bw_vs.host_site_season.NMDS, type=\"n\")\nordihull(bw_vs.host_site_season.NMDS, substr(rownames(bw_vs.host_site_season), 4, 5), draw=\"polygon\", col=\"#D3EAF1\", show.groups = \"KZ\", label=FALSE)\nordihull(bw_vs.host_site_season.NMDS, substr(rownames(bw_vs.host_site_season), 4, 5), draw=\"polygon\", col=\"#CEE9BF\", show.groups = \"MP\", label=FALSE)\norditorp(bw_vs.host_site_season.NMDS, display=\"sites\", air=0.01, label=FALSE, cex=2,\n         pch = c(\"Am\" = 16, \"Vs\" = 17)[substr(rownames(bw_vs.host_site_season), 1, 2)])\norditorp(bw_vs.host_site_season.NMDS, display=\"sites\", air=0.01, cex=1)\ndev.off()\n\n\n######## envfit acacia ###################\n\nacacia.envfit.all <- envfit(bw.NMDS, acacia.env.all, permu=999, na.rm=TRUE)\nacacia.envfit.KZN <- envfit(bw.KZN.NMDS, acacia.env.all[grepl(\"KZN\", row.names(acacia.env.all)),], permu=999, na.rm=TRUE)\nacacia.envfit.MP <- envfit(bw.MP.NMDS, acacia.env.all[grepl(\"MP\", row.names(acacia.env.all)),], permu=999, na.rm=TRUE)\n\nacacia.envfit.all\nacacia.envfit.KZN\nacacia.envfit.MP\n\n\n\n######## CCA ############################\nbw_vs.host_site_season.CCA <- cca(sqrt(bw_vs.host_site_season))\nbw_vs.host_site_season.CCA\nplot(bw_vs.host_site_season.CCA)\nplot(bw_vs.host_site_season.CCA, display = \"sites\")\n\n\n#####CCA envfit####\n\nbw.CCA <- cca(sqrt(bw), data=acacia.env.all)\nbw.CCA\nbw.envfit_CCA <- envfit(bw.CCA, env=acacia.env.all)\nbw.envfit_CCA\ndata.frame(\n  bw.envfit_CCA$vectors[[1]],\n  r2 = round(bw.envfit_CCA$vectors$r, 3),\n  pval = bw.envfit_CCA$vectors$pval\n)[\n  order(bw.envfit_CCA$vectors$r, decreasing=TRUE),\n  ]\n\n##conditioning latitude\n\nbw.lat_ord <- cca(sqrt(bw) ~ Condition(Lat), data=acacia.env.all)\nbw.lat_ord\nbw.efit_condition.on.lat <- envfit(bw.lat_ord, env=acacia.env.all)\nbw.efit_condition.on.lat\ndata.frame(\n  bw.efit_condition.on.lat$vectors[[1]],\n  r2 = round(bw.efit_condition.on.lat$vectors$r, 3),\n  pval = bw.efit_condition.on.lat$vectors$pval\n)[\n  order(bw.efit_condition.on.lat$vectors$r, decreasing=TRUE),\n]\n\n#### NMDS ENVFIT\nbw.NMDS\nbw.envfit_NMDS <- envfit(bw.NMDS, env=acacia.env.all)\nbw.envfit_NMDS\ndata.frame(\n  bw.envfit_NMDS$vectors[[1]],\n  r2 = round(bw.envfit_NMDS$vectors$r, 3),\n  pval = bw.envfit_NMDS$vectors$pval\n)[\n  order(bw.envfit_NMDS$vectors$r, decreasing=TRUE),\n  ]\n",
    "created" : 1472808595362.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2570342301",
    "id" : "D5FEC0FB",
    "lastKnownWriteTime" : 1459972086,
    "last_content_update" : 1459972086,
    "path" : "~/Desktop/Acacia data/Acacia.NMDS.R",
    "project_path" : "Acacia.NMDS.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}